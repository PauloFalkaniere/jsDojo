/*! 31-12-2013 */
var X=0,Y=1,Jogo=function(){var _tabuleiro;this.init=function(){_tabuleiro=[];for(var i=0;8>i;i++){_tabuleiro[i]=[];for(var j=0;8>j;j++)_tabuleiro[i][j]={}}var inicializa=function(linha,cor){_tabuleiro[linha][0]=new Torre(cor),_tabuleiro[linha][7]=new Torre(cor),_tabuleiro[linha][1]=new Cavalo(cor),_tabuleiro[linha][6]=new Cavalo(cor),_tabuleiro[linha][2]=new Bispo(cor),_tabuleiro[linha][5]=new Bispo(cor),_tabuleiro[linha][3]=new Rainha(cor),_tabuleiro[linha][4]=new Rei(cor);var linhaPeao=0===linha?1:6;for(i=0;8>i;i++)_tabuleiro[linhaPeao][i]=new Peao(cor)};inicializa(0,Cor.BRANCA),inicializa(7,Cor.PRETA)},this.posicao=function(i,j,peca){if(0>i||i>7||0>j||j>7)throw new Error("Posição não existe");void 0!==peca&&(_tabuleiro[i][j]=peca);var result=_tabuleiro[i][j];return null!==result&&result.cor?result:null},this.tabuleiro=function(){return _tabuleiro},this.move=function(posicaoInicial,posicalFinal){var peca=this.posicao(posicaoInicial[X],posicaoInicial[Y]),pecaDestino=this.posicao(posicalFinal[X],posicalFinal[Y]);if(null===peca)throw new Error("Não existe peça na posicao origem.");if(null!==pecaDestino&&peca.cor()===pecaDestino.cor())throw new Error("Existe uma peça da mesma cor na posição de destino.");peca.move(posicaoInicial,posicalFinal,this),peca.movimentada(!0),this.posicao(posicalFinal[X],posicalFinal[Y],peca),this.posicao(posicaoInicial[X],posicaoInicial[Y],{})}},Pecas={PEAO:"PEAO",TORRE:"TORRE",CAVALO:"CAVALO",BISPO:"BISPO",REI:"REI",RAINHA:"RAINHA"},Cor={BRANCA:"BRANCA",PRETA:"PRETA"},Peca=function(){var _cor,_movimentada=!1;this.init=function(cor){_cor=cor},this.cor=function(){return _cor},this.movimentada=function(movimentada){return _movimentada=movimentada===!0?!0:_movimentada}},Peao=function(cor){Peca.call(this),this.init(cor),this.move=function(posicaoInicial,posicaoFinal,jogo){var validoParaFrente=posicaoFinal[X]-posicaoInicial[X]===1&&posicaoFinal[Y]==posicaoInicial[Y],validoDiagonal=posicaoFinal[X]-posicaoInicial[X]===1&&posicaoFinal[Y]-posicaoInicial[Y]===1&&null!==jogo.posicao(posicaoFinal[X],posicaoFinal[Y]);if(!validoDiagonal&&!validoParaFrente)throw new Error("Movimento invalido")}},Torre=function(cor){Peca.call(this),this.init(cor),this.move=function(posicaoInicial,posicaoFinal){if(posicaoInicial[X]!==posicaoFinal[X]&&posicaoInicial[Y]!==posicaoFinal[Y])throw new Error("Movimento invalido")}},Cavalo=function(cor){Peca.call(this),this.init(cor)},Bispo=function(cor){Peca.call(this),this.init(cor),this.move=function(posicaoInicial,posicaoFinal){if(Math.abs(posicaoInicial[X]-posicaoFinal[X])!==Math.abs(posicaoInicial[Y]-posicaoFinal[Y]))throw new Error("Movimento invalido")}},Rainha=function(cor){Peca.call(this),this.init(cor),this.move=function(posicaoInicial,posicaoFinal){var movimentoHorizontalValido=posicaoInicial[X]===posicaoFinal[X]||posicaoInicial[Y]===posicaoFinal[Y],movimentoDiagonalValido=Math.abs(posicaoInicial[X]-posicaoFinal[X])===Math.abs(posicaoInicial[Y]-posicaoFinal[Y]);if(!movimentoDiagonalValido&&!movimentoHorizontalValido)throw new Error("Movimento invalido!")}},Rei=function(cor){Peca.call(this),this.init(cor),this.move=function(posicaoInicial,posicaoFinal){var movimentoXmenorQueDois=Math.abs(posicaoFinal[X]-posicaoInicial[X])<=1&&Math.abs(posicaoFinal[Y]-posicaoInicial[Y])<=1;if(!movimentoXmenorQueDois)throw new Error("Movimento invalido!")}};